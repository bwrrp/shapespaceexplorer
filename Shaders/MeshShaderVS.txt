attribute vec3 shape;
attribute vec3 reference;

varying vec3 normal;

varying float deformation;

void main()
{
	vec4 vertex = gl_Vertex;
	vertex += vec4(shape, 0.0);
	gl_Position = gl_ModelViewProjectionMatrix * vertex;
	// TODO: normals are invalid after deformation, use image-based shading instead
	normal = gl_NormalMatrix * gl_Normal;
	vec3 delta = shape - reference;
	deformation = dot(delta, gl_Normal);
}
